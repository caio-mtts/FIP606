{
  "hash": "23b9eca5febeaaf3beac01bbb466b639",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Aula 09 - Estatística inferencial - Experimento em parcelas subdivididas\"\nformat: html\neditor: visual\nexecute: \n  error: false\n  warning: false\n---\n\n\n## Carregando os pacotes\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(gsheet)\nlibrary(tidyverse)\nlibrary(lme4)\nlibrary(car)\nlibrary(performance)\nlibrary(DHARMa)\nlibrary(emmeans)\nlibrary(multcomp)\nlibrary(multcompView)\nlibrary(patchwork)\nlibrary(r4pde)\n```\n:::\n\n\n## Análise de um experimento em parcelas subdivididas\n\nExperimentos em parcelas subdivididas são utilizados quando o nível de um fator primário (ou tratamento) é aplicado a uma parcela relativamente grande e todos os níveis de um segundo fator secundário são aplicados às subparcelas desta parcela maior. Os tratamentos primários são distribuídos às parcelas de acordo com um delineamento especificado, já os tratamentos secundários são distribuídos às subparcelas de forma aleatória.\\\n\n## Importando os dados\n\nPara exemplificar a análise de um experimento em parcelas subdivididas, será utilizado um conjunto de dados onde o objetivo foi avaliar o índice de doença e produtividade de híbridos de milho (fator primário) ao serem submetidos a dois métodos de inoculação (fator secundário). Um esboço desse arranjo experimental é apresentado abaixo.\n\n![Experimento em parcelas subdivididas.](Imagem1.png){width=\"1650\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmilho <- gsheet::gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=1345524759\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(milho)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 48\nColumns: 5\n$ hybrid <chr> \"30F53 HX\", \"30F53 HX\", \"30F53 HX\", \"30F53 HX\", \"30F53 YH\", \"30…\n$ block  <dbl> 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, …\n$ method <chr> \"pin\", \"pin\", \"pin\", \"pin\", \"pin\", \"pin\", \"pin\", \"pin\", \"pin\", …\n$ index  <dbl> 21.1, 21.1, 23.3, 35.6, 21.1, 22.2, 27.3, 27.8, 20.0, 20.0, 27.…\n$ yield  <dbl> 12920, 9870, 8920, 13120, 12060, 7860, 7410, 10300, 11700, 1070…\n```\n\n\n:::\n:::\n\n\n## Visualização gráfica\n\n### Índice de doença\n\nPara visualização dos dados relacionados ao índice de doença e o método de inoculação será construído um gráfico de pontos (`geom_jitter`) acrescido do intervalo de confiança (`stat_summary(fund.data = \"mean_cl_boot\"`). Para gerar uma figura com os gráficos individuais de cada tratamento é utilizada a função `facet_wrap`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmilho %>% \n  ggplot(aes(method, index))+\n  geom_jitter(color = \"darkred\", width = 0.1, alpha = 0.4)+\n  stat_summary(fund.data = \"mean_cl_boot\", color = \"black\", width = 0.5)+\n  facet_wrap (~hybrid)\n```\n\n::: {.cell-output-display}\n![](Aula-9.1_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n### Produtividade\n\nPara os dados relacionados à produtividade e o método de inoculação será construído um gráfico de similar ao anterior.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmilho %>% \n  ggplot(aes(method, yield))+\n  geom_jitter(color = \"darkred\", width = 0.1, alpha = 0.4)+\n  stat_summary(fund.data = \"mean_cl_boot\", color = \"black\", width = 0.5)+\n  facet_wrap (~hybrid)\n```\n\n::: {.cell-output-display}\n![](Aula-9.1_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n## Análise de experimentos em parcelas subdivididas\n\n## Índice de doença (index)\n\n### Construção do modelo\n\nAntes de definir o modelo, será preciso transformar a coluna de dados \"block\" para fator (funções `mutate` e `as.factor`).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmilho <- milho %>% \n  mutate(block = as.factor(block))\n```\n:::\n\n\nPara a análise dos dados, será construído um modelo linear de efeitos mistos com a função `lmer` (pacote **`lme4`**), onde definimos os fatores fixos e os fatores aleatórios.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmix <- lmer(index ~ hybrid*method + block + (1|block/hybrid),\n            data = milho)\n```\n:::\n\n\n### ANOVA\n\n\n::: {.cell}\n\n```{.r .cell-code}\nAnova(mix)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Deviance Table (Type II Wald chisquare tests)\n\nResponse: index\n                Chisq Df Pr(>Chisq)   \nhybrid        15.5971  5   0.008094 **\nmethod         4.6963  1   0.030228 * \nblock          0.2157  3   0.975023   \nhybrid:method 15.8060  5   0.007420 **\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\nA análise de variância demonstra que há interação entre os fatores (hybrid:method). Assim seria preciso realizar os desdobramentos e comparar híbridos dentro de métodos e métodos dentro de híbridos. Mas antes, é preciso conferir se os dados atendem às pressuposições da ANOVA.\n\n### Avaliação das premissas\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncheck_normality(mix)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nOK: residuals appear as normally distributed (p = 0.635).\n```\n\n\n:::\n\n```{.r .cell-code}\ncheck_heteroscedasticity(mix)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nWarning: Heteroscedasticity (non-constant error variance) detected (p = 0.009).\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(simulateResiduals(mix))\n```\n\n::: {.cell-output-display}\n![](Aula-9.1_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\nCom as análises acima, conclui-se que os dados seguem distribuição normal. Porém, não há homogeneidade de variância entre os grupos. Logo será preciso uma alternativa para prosseguir a análise, por exemplo a transformação dos dados com raiz quadrada.\n\n### Transformação dos dados - Raiz quadrada\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmix2 <- lmer(sqrt(index) ~ hybrid*method + block + (1|block/hybrid),\n            data = milho)\n```\n:::\n\n\n#### ANOVA - Dados transformados\n\n\n::: {.cell}\n\n```{.r .cell-code}\nanova(mix2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Variance Table\n              npar  Sum Sq Mean Sq F value\nhybrid           5 2.14415 0.42883  3.0632\nmethod           1 0.54438 0.54438  3.8886\nblock            3 0.01004 0.00335  0.0239\nhybrid:method    5 1.87331 0.37466  2.6762\n```\n\n\n:::\n:::\n\n\n#### Avaliação das premissas - Dados transformados\n\nCom as funções `check_normality` e `check_heteroscedasticity` (pacote **`Performance`**):\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncheck_normality(mix2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nOK: residuals appear as normally distributed (p = 0.440).\n```\n\n\n:::\n\n```{.r .cell-code}\ncheck_heteroscedasticity(mix2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nOK: Error variance appears to be homoscedastic (p = 0.971).\n```\n\n\n:::\n:::\n\n\nAtravés de um gráfico Q-Q (funções `qqnorm` e `qqline`):\n\n\n::: {.cell}\n\n```{.r .cell-code}\nqqnorm(residuals(mix2))\nqqline(residuals(mix2))\n```\n\n::: {.cell-output-display}\n![](Aula-9.1_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\nCom a função `simulateResiduals` (pacote **`DHARMa`**):\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(simulateResiduals(mix2))\n```\n\n::: {.cell-output-display}\n![](Aula-9.1_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\nApesar da análise via **`DHARMa`** ter apresentado problemas, as demais avaliações (via **`Performance`** e QQ-Plot) se mostraram favoráveis, logo é possível prosseguir para a comparação de médias.\n\n#### Comparação de médias - Dados transformados\n\nComo visto pela ANOVA, há efeito de interação, logo será preciso realizar desdobramentos para as comparações:\n\n##### Híbridos dentro de métodos:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nindex <- emmeans(mix2, ~hybrid | method,\n                 type = \"response\")\n\ncld(index, Letters = LETTERS)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nmethod = pin:\n hybrid   response   SE   df lower.CL upper.CL .group\n BG7049H      19.4 10.7 6084     4.10     46.0  A    \n 30K64        20.3 10.9 6084     4.51     47.4  A    \n 30F53 YH     24.5 12.0 6084     6.61     53.7  AB   \n 30F53 HX     25.0 12.1 6084     6.84     54.4  AB   \n 30S31YH      31.7 13.7 6084    10.57     64.2  AB   \n 30S31H       37.1 14.8 6084    13.79     71.8   B   \n\nmethod = silk:\n hybrid   response   SE   df lower.CL upper.CL .group\n BG7049H      19.1 10.6 6084     3.96     45.6  A    \n 30K64        21.3 11.2 6084     5.00     48.9  A    \n 30F53 HX     24.4 12.0 6084     6.56     53.6  A    \n 30F53 YH     26.0 12.4 6084     7.42     56.0  A    \n 30S31H       26.3 12.5 6084     7.57     56.4  A    \n 30S31YH      26.4 12.5 6084     7.62     56.5  A    \n\nResults are averaged over the levels of: block \nDegrees-of-freedom method: kenward-roger \nConfidence level used: 0.95 \nIntervals are back-transformed from the sqrt scale \nNote: contrasts are still on the sqrt scale \nP value adjustment: tukey method for comparing a family of 6 estimates \nsignificance level used: alpha = 0.05 \nNOTE: If two or more means share the same grouping symbol,\n      then we cannot show them to be different.\n      But we also did not show them to be the same. \n```\n\n\n:::\n:::\n\n\n##### Métodos dentro de híbridos\n\n\n::: {.cell}\n\n```{.r .cell-code}\nindex2 <- emmeans(mix2, ~method | hybrid,\n                  type = \"response\")\n\ncld(index2, Letters = letters)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nhybrid = 30F53 HX:\n method response   SE   df lower.CL upper.CL .group\n silk       24.4 12.0 6084     6.56     53.6  a    \n pin        25.0 12.1 6084     6.84     54.4  a    \n\nhybrid = 30F53 YH:\n method response   SE   df lower.CL upper.CL .group\n pin        24.5 12.0 6084     6.61     53.7  a    \n silk       26.0 12.4 6084     7.42     56.0  a    \n\nhybrid = 30K64:\n method response   SE   df lower.CL upper.CL .group\n pin        20.3 10.9 6084     4.51     47.4  a    \n silk       21.3 11.2 6084     5.00     48.9  a    \n\nhybrid = 30S31H:\n method response   SE   df lower.CL upper.CL .group\n silk       26.3 12.5 6084     7.57     56.4  a    \n pin        37.1 14.8 6084    13.79     71.8   b   \n\nhybrid = 30S31YH:\n method response   SE   df lower.CL upper.CL .group\n silk       26.4 12.5 6084     7.62     56.5  a    \n pin        31.7 13.7 6084    10.57     64.2  a    \n\nhybrid = BG7049H:\n method response   SE   df lower.CL upper.CL .group\n silk       19.1 10.6 6084     3.96     45.6  a    \n pin        19.4 10.7 6084     4.10     46.0  a    \n\nResults are averaged over the levels of: block \nDegrees-of-freedom method: kenward-roger \nConfidence level used: 0.95 \nIntervals are back-transformed from the sqrt scale \nNote: contrasts are still on the sqrt scale \nsignificance level used: alpha = 0.05 \nNOTE: If two or more means share the same grouping symbol,\n      then we cannot show them to be different.\n      But we also did not show them to be the same. \n```\n\n\n:::\n:::\n\n\n## Produtividade (yield)\n\nSeguindo os mesmos procedimentos para o índice de doença, será conduzida avaliação da produtividade.\n\n### Construção do modelo\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmix3 <- lmer(yield ~ hybrid*method + block + (1|block/hybrid),\n            data = milho)\n```\n:::\n\n\n### ANOVA\n\n\n::: {.cell}\n\n```{.r .cell-code}\nAnova(mix3)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Deviance Table (Type II Wald chisquare tests)\n\nResponse: yield\n                Chisq Df Pr(>Chisq)    \nhybrid        25.5991  5  0.0001067 ***\nmethod         0.1052  1  0.7456934    \nblock          2.3564  3  0.5018078    \nhybrid:method 25.9302  5  9.206e-05 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\n### Avaliação das premissas\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncheck_normality(mix3)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nOK: residuals appear as normally distributed (p = 0.211).\n```\n\n\n:::\n\n```{.r .cell-code}\ncheck_heteroscedasticity(mix3)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nWarning: Heteroscedasticity (non-constant error variance) detected (p < .001).\n```\n\n\n:::\n:::\n\n\nA análise pelas funções check_normality e check_heteroscedasticity demonstram que os dados possuem normalidade na distribuição dos resíduos, no entanto, não há homogeneidade de variância entre os grupos. Portanto, também será preciso realizar transformação.\n\n#### Transformação dos dados - Raiz quadrada\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmix4 <- lmer(sqrt(yield) ~ hybrid*method + block + (1|block/hybrid),\n            data = milho)\n```\n:::\n\n\n#### ANOVA - Dados transformados\n\n\n::: {.cell}\n\n```{.r .cell-code}\nanova(mix4)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Variance Table\n              npar  Sum Sq Mean Sq F value\nhybrid           5 272.298  54.460  5.1118\nmethod           1   0.554   0.554  0.0520\nblock            3  25.150   8.383  0.7869\nhybrid:method    5 260.999  52.200  4.8997\n```\n\n\n:::\n:::\n\n\n#### Avaliação das premissas - Dados transformados\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncheck_normality(mix4)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nOK: residuals appear as normally distributed (p = 0.214).\n```\n\n\n:::\n\n```{.r .cell-code}\ncheck_heteroscedasticity(mix4)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nOK: Error variance appears to be homoscedastic (p = 0.686).\n```\n\n\n:::\n:::\n\n\n#### Comparação de médias - Dados transformados\n\n##### Híbridos dentro de métodos:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nyield <- emmeans(mix4, ~ hybrid | method,\n                 type = \"response\")\ncld(index, Letters = LETTERS)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nmethod = pin:\n hybrid   response   SE   df lower.CL upper.CL .group\n BG7049H      19.4 10.7 6084     4.10     46.0  A    \n 30K64        20.3 10.9 6084     4.51     47.4  A    \n 30F53 YH     24.5 12.0 6084     6.61     53.7  AB   \n 30F53 HX     25.0 12.1 6084     6.84     54.4  AB   \n 30S31YH      31.7 13.7 6084    10.57     64.2  AB   \n 30S31H       37.1 14.8 6084    13.79     71.8   B   \n\nmethod = silk:\n hybrid   response   SE   df lower.CL upper.CL .group\n BG7049H      19.1 10.6 6084     3.96     45.6  A    \n 30K64        21.3 11.2 6084     5.00     48.9  A    \n 30F53 HX     24.4 12.0 6084     6.56     53.6  A    \n 30F53 YH     26.0 12.4 6084     7.42     56.0  A    \n 30S31H       26.3 12.5 6084     7.57     56.4  A    \n 30S31YH      26.4 12.5 6084     7.62     56.5  A    \n\nResults are averaged over the levels of: block \nDegrees-of-freedom method: kenward-roger \nConfidence level used: 0.95 \nIntervals are back-transformed from the sqrt scale \nNote: contrasts are still on the sqrt scale \nP value adjustment: tukey method for comparing a family of 6 estimates \nsignificance level used: alpha = 0.05 \nNOTE: If two or more means share the same grouping symbol,\n      then we cannot show them to be different.\n      But we also did not show them to be the same. \n```\n\n\n:::\n:::\n\n\n##### Métodos dentro de híbridos\n\n\n::: {.cell}\n\n```{.r .cell-code}\nyield2 <- emmeans(mix4, ~ method | hybrid,\n                  type = \"response\")\ncld(index2, Letters = letters)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nhybrid = 30F53 HX:\n method response   SE   df lower.CL upper.CL .group\n silk       24.4 12.0 6084     6.56     53.6  a    \n pin        25.0 12.1 6084     6.84     54.4  a    \n\nhybrid = 30F53 YH:\n method response   SE   df lower.CL upper.CL .group\n pin        24.5 12.0 6084     6.61     53.7  a    \n silk       26.0 12.4 6084     7.42     56.0  a    \n\nhybrid = 30K64:\n method response   SE   df lower.CL upper.CL .group\n pin        20.3 10.9 6084     4.51     47.4  a    \n silk       21.3 11.2 6084     5.00     48.9  a    \n\nhybrid = 30S31H:\n method response   SE   df lower.CL upper.CL .group\n silk       26.3 12.5 6084     7.57     56.4  a    \n pin        37.1 14.8 6084    13.79     71.8   b   \n\nhybrid = 30S31YH:\n method response   SE   df lower.CL upper.CL .group\n silk       26.4 12.5 6084     7.62     56.5  a    \n pin        31.7 13.7 6084    10.57     64.2  a    \n\nhybrid = BG7049H:\n method response   SE   df lower.CL upper.CL .group\n silk       19.1 10.6 6084     3.96     45.6  a    \n pin        19.4 10.7 6084     4.10     46.0  a    \n\nResults are averaged over the levels of: block \nDegrees-of-freedom method: kenward-roger \nConfidence level used: 0.95 \nIntervals are back-transformed from the sqrt scale \nNote: contrasts are still on the sqrt scale \nsignificance level used: alpha = 0.05 \nNOTE: If two or more means share the same grouping symbol,\n      then we cannot show them to be different.\n      But we also did not show them to be the same. \n```\n\n\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}