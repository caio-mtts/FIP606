{
  "hash": "c5ea70853ff1237b71ab92b8e6271c2d",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Aula 07 - Estatística inferencial - Análise de variância\"\nformat: html\neditor: visual\nexecute: \n  error: false\n  warning: false\n---\n\n\nNesta aula, será realizada uma análise de variância (ANOVA) usando o conjunto de dados InsectSprays. Serão demonstrados como ajustar um modelo de regressão linear (lm), necessário para a ANOVA, os passos a seguir para verificar as premissas da ANOVA e os testes para comparação de médias que podem ser aplicados. Também serão apresentadas alternativas para a análise dos dados caso não atendam às pressuposições da ANOVA, como transformações, testes não-paramétricos e modelos lineares generalizados. Por fim, será realizada uma análise fatorial com um segundo conjunto de dados.\n\n## Carregando os pacotes\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(gsheet)\nlibrary(tidyverse)\nlibrary(performance)\nlibrary(DHARMa)\nlibrary(emmeans)\nlibrary(multcomp)\nlibrary(multcompView)\n```\n:::\n\n\n## Exemplo de Análise de Variância (ANOVA)\n\nPara realizar a análise de variância (ANOVA), será carregado um conjunto de dados presente no R (conjunto `InsectSprays`), que será atribuído a um objeto:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninseticida <- InsectSprays\n\ninseticida %>% \n  count(spray)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  spray  n\n1     A 12\n2     B 12\n3     C 12\n4     D 12\n5     E 12\n6     F 12\n```\n\n\n:::\n:::\n\n\nCom a fórmula `count`, identificamos que nesse conjunto de dados há um fator (inseticida), com 6 níveis (tipos de inseticidas), cada nível com 12 observações.\\\n\n## Explorando o conjunto\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninseticida %>%\n  ggplot(aes(spray, count))+\n  geom_boxplot(width = 0.5)\n```\n\n::: {.cell-output-display}\n![](Aula-7.1_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\nCom o boxplot gerado, é possível notar que há tratamentos que diferem dos demais.\\\n\n## Ajustar o modelo para ANOVA\n\nPara realizar a ANOVA é preciso ajustar um modelo (`lm`). Isso é necessário para que os resíduos possam ser aplicados nos testes para verificação das premissas da anova. O modelo será atribuído a um objeto.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm1 <- lm(count~spray, data = inseticida)\nsummary(m1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = count ~ spray, data = inseticida)\n\nResiduals:\n   Min     1Q Median     3Q    Max \n-8.333 -1.958 -0.500  1.667  9.333 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  14.5000     1.1322  12.807  < 2e-16 ***\nsprayB        0.8333     1.6011   0.520    0.604    \nsprayC      -12.4167     1.6011  -7.755 7.27e-11 ***\nsprayD       -9.5833     1.6011  -5.985 9.82e-08 ***\nsprayE      -11.0000     1.6011  -6.870 2.75e-09 ***\nsprayF        2.1667     1.6011   1.353    0.181    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 3.922 on 66 degrees of freedom\nMultiple R-squared:  0.7244,\tAdjusted R-squared:  0.7036 \nF-statistic:  34.7 on 5 and 66 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n:::\n\n\n### ANOVA\n\nUma vez definido o modelo, ele será utilizado como um argumento na função `anova`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nanova(m1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Variance Table\n\nResponse: count\n          Df Sum Sq Mean Sq F value    Pr(>F)    \nspray      5 2668.8  533.77  34.702 < 2.2e-16 ***\nResiduals 66 1015.2   15.38                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\nCom a análise de variância e interpretação da estatística \"*F*\" é possível dizer que dentre os tratamentos, há algum que difere estatisticamente dos demais.\\\n\\\n\n## Avaliação das premissas\n\n### Estratégia 1\n\nPrimeiro, será analisada a normalidade dos resíduos de maneira visual (função `hist`) e estatisticamente (função `shapiro.test`).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhist(m1$residuals)\n```\n\n::: {.cell-output-display}\n![](Aula-7.1_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n\n```{.r .cell-code}\nshapiro.test(m1$residuals)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tShapiro-Wilk normality test\n\ndata:  m1$residuals\nW = 0.96006, p-value = 0.02226\n```\n\n\n:::\n:::\n\n\nApesar do histograma possuir aspecto de normalidade, o teste de Shapiro-Wilk demonstra que os resíduos não possuem normalidade (valor de P = 0.02).\\\n\\\nA normalidade também pode ser avaliada visualmente em um gráifco Q-Q, com as funções `qqnorm` e `qqline`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nqqnorm(m1$residuals)\nqqline(m1$residuals)\n```\n\n::: {.cell-output-display}\n![](Aula-7.1_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\nO gráfico Q-Q mostra que os pontos desviam da linha de normalidade apenas nas regiões extremas, o que justifica o fato do teste de Shapiro-Wilk ter rejeitado a hipótese de normalidade dos resíduos.\\\n\\\n\\\nEm sequência, com o teste de Bartlett (`bartlett.test`), será avaliada a homogeneidade das variâncias entre os grupos:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbartlett.test(count ~ spray,\n              data = inseticida)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tBartlett test of homogeneity of variances\n\ndata:  count by spray\nBartlett's K-squared = 25.96, df = 5, p-value = 9.085e-05\n```\n\n\n:::\n:::\n\n\nO teste de Bartlett demonstra que as variâncias são heterogêneas, pois valor de P é menor que 0.01.\n\n### Estratégia 2\n\nUsando o pacote **`performance`**:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncheck_normality(m1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nWarning: Non-normality of residuals detected (p = 0.022).\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncheck_heteroscedasticity(m1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nWarning: Heteroscedasticity (non-constant error variance) detected (p < .001).\n```\n\n\n:::\n:::\n\n\nO testes `check_normality` e `check_heteroscedasticity` resultaram em não normalidade dos resíduos e heterocedasticidade entre os grupos.\n\n### Estratégia 3\n\nCom o pacote **`DHARMa`**:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(simulateResiduals(m1))\n```\n\n::: {.cell-output-display}\n![](Aula-7.1_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\nDa mesma forma que as estratégias anteriores, aqui observa-se falta de normalidade e homogeneidade entre as variâncias dos grupos.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}