{"title":"Aula 7 - Estat√≠stica inferencial: ANOVA","markdown":{"yaml":{"title":"Aula 7 - Estat√≠stica inferencial: ANOVA","author":"Caio","format":"html","editor":"visual","execute":{"error":false,"warning":false}},"headingText":"Aula 07","containsRefs":false,"markdown":"\n\n\n## Carregando os pacotes\n\n```{r}\nlibrary(gsheet)\nlibrary(tidyverse)\nlibrary(performance)\nlibrary(DHARMa)\nlibrary(emmeans)\nlibrary(multcomp)\nlibrary(multcompView)\n```\n\n## Exemplo de An√°lise de Vari√¢ncia (ANOVA)\n\nPara realizar a an√°lise de vari√¢ncia (ANOVA), ser√° carregado um conjunto de dados presente no R (conjunto `InsectSprays`), que ser√° atribu√≠do a um objeto:\n\n```{r}\ninseticida <- InsectSprays\n\ninseticida %>% \n  count(spray)\n```\n\nCom a f√≥rmula `count`, identificamos que nesse conjunto de dados h√° um fator (inseticida), com 6 n√≠veis (tipos de inseticidas), cada n√≠vel com 12 observa√ß√µes.\\\n\n## Explorando o conjunto\n\n```{r}\ninseticida %>%\n  ggplot(aes(spray, count))+\n  geom_boxplot(width = 0.5)\n```\n\nCom o boxplot gerado, √© poss√≠vel notar que h√° tratamentos que diferem dos demais.\\\n\n## Ajustar o modelo para ANOVA\n\nPara realizar a ANOVA √© preciso ajustar um modelo (`lm`). Isso √© necess√°rio para que os res√≠duos possam ser aplicados nos testes para verifica√ß√£o das premissas da anova. O modelo ser√° atribu√≠do a um objeto.\n\n```{r}\nm1 <- lm(count~spray, data = inseticida)\nsummary(m1)\n```\n\n### ANOVA\n\nUma vez definido o modelo, ele ser√° utilizado como um argumento na fun√ß√£o `anova`:\n\n```{r}\nanova(m1)\n```\n\nCom a an√°lise de vari√¢ncia e interpreta√ß√£o da estat√≠stica \"*F*\" √© poss√≠vel dizer que dentre os tratamentos, h√° algum que difere estatisticamente dos demais.\\\n\\\n\n## Avalia√ß√£o das premissas\n\n### Estrat√©gia 1\n\nPrimeiro, ser√° analisada a normalidade dos res√≠duos de maneira visual (fun√ß√£o `hist`) e estatisticamente (fun√ß√£o `shapiro.test`).\n\n```{r}\nhist(m1$residuals)\n\nshapiro.test(m1$residuals)\n```\n\nApesar do histograma possuir aspecto de normalidade, o teste de Shapiro-Wilk demonstra que os res√≠duos n√£o possuem normalidade (valor de P = 0.02).\\\n\\\nA normalidade tamb√©m pode ser avaliada visualmente em um gr√°ifco Q-Q, com as fun√ß√µes `qqnorm` e `qqline`:\n\n```{r}\nqqnorm(m1$residuals)\nqqline(m1$residuals)\n```\n\nO gr√°fico Q-Q mostra que os pontos desviam da linha de normalidade apenas nas regi√µes extremas, o que justifica o fato do teste de Shapiro-Wilk ter rejeitado a hip√≥tese de normalidade dos res√≠duos.\\\n\\\n\\\nEm sequ√™ncia, com o teste de Bartlett (`bartlett.test`), ser√° avaliada a homogeneidade das vari√¢ncias entre os grupos:\n\n```{r}\nbartlett.test(count ~ spray,\n              data = inseticida)\n```\n\nO teste de Bartlett demonstra que as vari√¢ncias s√£o heterog√™neas, pois valor de P √© menor que 0.01.\n\n### Estrat√©gia 2\n\nUsando o pacote **`performance`**:\n\n```{r}\ncheck_normality(m1)\n```\n\n```{r}\ncheck_heteroscedasticity(m1)\n```\n\nO testes `check_normality` e `check_heteroscedasticity` resultaram em n√£o normalidade dos res√≠duos e heterocedasticidade entre os grupos.\n\n### Estrat√©gia 3\n\nCom o pacote **`DHARMa`**:\n\n```{r}\nplot(simulateResiduals(m1))\n```\n\nDa mesma forma que as estrat√©gias anteriores, aqui observa-se falta de normalidade e homogeneidade entre as vari√¢ncias dos grupos.\n\n## Transforma√ß√£o dos dados\n\nDiante dos resultados obtidos, conclui-se que o conjunto de dados n√£o atende as pressuposi√ß√µes da ANOVA, logo √© necess√°rio definir uma estrat√©gia para prosseguir na an√°lise dos dados. √â poss√≠vel realizar transforma√ß√µes da vari√°vel resposta, adotar um teste n√£o-param√©trico (por exemplo, teste de Kruskal-Wallis), ou utilizar um modelo linear generalizado (Generalized Linear Model - GLM). A seguir, s√£o apresentados exemplos de como se adotar cada estrat√©gia:\n\n### Alternativa 1 - Raiz quadrada\n\nOs dados ser√£o transformados com a fun√ß√£o `sqrt` e a coluna da vari√°vel resposta ser√° substitu√≠da com os novos valores:\n\n```{r}\ninseticida <- inseticida %>% \n  mutate(count2 = sqrt(count))\n\nglimpse(inseticida)\n```\n\n#### An√°lise visual dos dados transformados\n\n```{r}\ninseticida %>%\n  ggplot(aes(spray, count2))+\n  geom_boxplot(width = 0.5)\n\n```\n\nVisualmente, √© poss√≠vel dizer que, possivelmente, os dados transformados agora possuem normalidade e homocedasticidade, pois os valores de mediana tendem a se encontrar nos centros da caixas e essas tem tamanho mais ou menos similar entre si.\n\n#### Ajuste do novo modelo\n\n```{r}\nm2 <- lm(count2 ~ spray,\n         data = inseticida)\n\nsummary(m2)\n```\n\n#### ANOVA com os novos dados\n\n```{r}\nanova (m2)\n```\n\nMesmo ap√≥s transforma√ß√£o, os dados continuem apresentando diferen√ßa significativa, ou seja, h√° pelo menos uma m√©dia que difere das demais.\n\n#### Avalia√ß√£o das premissas - Normalidade\n\n```{r}\nhist(m2$residuals)\n```\n\n```{r}\nqqnorm(m2$residuals)\nqqline(m2$residuals)\n```\n\n```{r}\nshapiro.test(m2$residuals)\n```\n\nVisual e estatisticamente, conclui-se que os res√≠duos do conjunto de dados transformados possuem distribui√ß√£o normal.\n\n#### Avalia√ß√£o das premissas - Homocedasticidade\n\n```{r}\nbartlett.test(count2 ~ spray,\n              data = inseticida)\n```\n\nAp√≥s a transforma√ß√£o, √© poss√≠vel dizer que h√° homogeneidade de vari√¢ncias entre os grupos.\n\n#### Avalia√ß√£o das premissas - Pacote `performance`:\n\n```{r}\ncheck_normality(m2)\ncheck_heteroscedasticity(m2)\n```\n\n#### Avalia√ß√£o das premissas - Pacote **`DHARMa`**\n\n```{r}\nplot(simulateResiduals(m2))\n```\n\nAp√≥s os v√°rios testes realizados, temos confian√ßa que os dados transformados possuem distribui√ß√£o normal e homogeneidade das vari√¢ncias. Logo, √© poss√≠vel realizar compara√ß√µes de m√©dias.\n\n### Compara√ß√£o de m√©dias\n\n#### Para o modelo 1 - n√£o transformado (n√£o atendendo √†s pressuposi√ß√µes):\n\nApenas √† t√≠tulo de curiosidade, ser√° feita uma compara√ß√£o de m√©dias com base nos valores originais. O que n√£o √© correto, uma vez que esses n√£o satisfazem as pressuposi√ß√µes da ANOVA.\\\nPara isso, a fun√ß√£o `emmeans`, indicando o modelo (m1) e os tratamentos (spray), ser√° atribu√≠da a um objeto.\n\n```{r}\nm1_medias <- emmeans(m1, ~ spray)\nplot(m1_medias)\n```\n\nO gr√°fico gerado mostra que para essa situa√ß√£o, os tratamentos tendem a formar dois grupos de efici√™ncia.\n\n```{r}\nmultcomp::cld(m1_medias)\n```\n\nO que √© comprovado estatisticamente pela compara√ß√£o de m√©dias, utilizando o teste de Tukey.\n\n#### Para o modelo 2 - transformado\n\nPara os dados transformados, ser√£o aplicados os mesmos passos descritos acima:\n\n```{r}\nm2_medias <- emmeans(m2, ~ spray)\nplot(m2_medias)\n```\n\nVisualmente, √© poss√≠vel dizer que os inseticidas formam tr√™s grupos distintos.\n\n```{r}\nmultcomp::cld(m2_medias)\n```\n\nCom a m√©dia transformada, o teste de Tukey agrupa os tratamentos em 3 grupos distintos, logo houve melhor discrimina√ß√£o. Com isso, conclu√≠mos que, em compara√ß√£o aos demais, o inseticida C foi o mais eficiente, pois apresentou menor n√∫mero de insetos contados. Em seguida, os inseticidas E e D apresentaram desempenho intermedi√°rio. Por fim, h√° um grupo com os inseticidas menos eficientes, nesse caso, contendo os tratamentos A, B e F.\n\n#### Alternativas para visualiza√ß√£o das compara√ß√µes de m√©dias\n\n#### Fun√ß√£o `pwpm`:\n\nA fun√ß√£o `pwpm` (`emmeans`) constr√≥i uma matriz de valores de probabilidade, onde s√£o apresentadas as compara√ß√µes entre tratamentos, par a par. Nas diagonais, entre colchetes, s√£o apresentados os valores de m√©dia de cada tratamento.\n\n```{r}\npwpm(m2_medias)\n```\n\n#### Fun√ß√£o `pwpp`:\n\nA fun√ß√£o `pwpp` (`emmeans`) constr√≥i uma plotagem de valores de probabilidade associados as compara√ß√µes pareadas das m√©dias marginais estimadas.\n\n```{r}\npwpp (m2_medias)\n```\n\n#### Fun√ß√£o `pairs`:\n\nA fun√ß√£o `pairs` apresenta os contrastes ortogonais dos valores de m√©dias dos tratamentos, associados aos valores de probabilidade.\n\n```{r}\npairs(m2_medias)\n```\n\n### Alternativa 1.2 - Transforma√ß√£o de Box--Cox\n\nPara tentar sanar o problema da falta de normalidade e/ou heterocedasticidade, √© poss√≠vel utilizar um segundo tipo de transforma√ß√£o, neste caso a transforma√ß√£o de Box-Cox.\n\nA transforma√ß√£o de Box-Cox se baseia na seguinte equa√ß√£o:\n\n$y_{(\\lambda)} = (y^{\\lambda} - 1)/ \\lambda$\n\nOnde, y representa a vari√°vel resposta original; $y_{(\\lambda)}$ √© a vari√°vel resposta transformada; e lambda (ùõå) √© o par√¢metro de transforma√ß√£o, variando entre - ‚àû e + ‚àû.\n\n\\\nPara conduzir essa transforma√ß√£o, √© utilizada a fun√ß√£o `boxcox` (pacote `MASS`). A fun√ß√£o calcula e identifica o valor ùõå √≥timo para um determinado conjunto de dados (onde o valor de Y √© m√°ximo).\n\n```{r}\nlibrary(MASS)\n\nb <- boxcox(lm(inseticida$count + 0.1 ~ 1))\n```\n\n```{r}\nlambda <- b$x [which.max(b$y)]\nlambda\n```\n\nCom os comandos acima √© poss√≠vel determinar na equa√ß√£o (b) o valor de ùõå (no eixo x), cujo valor de y √© m√°ximo. Logo, para o conjunto em an√°lise, ùõå ‚âÖ 0.42.\n\n#### Transformando os dados com Box-Cox\n\nCom o valor calculado acima, realiza-se a transforma√ß√£o de Box-Cox:\n\n```{r}\ninseticida$count3 <-(inseticida$count ^ lambda - 1) / lambda\n```\n\n\\\nNovo modelo\n\n```{r}\nm3 <- lm(count3 ~ spray,\n         data = inseticida)\n```\n\n\\\nAvalia√ß√£o de normalidade e homogeneidade de vari√¢ncias entre os grupos:\n\n```{r}\nhist(inseticida$count3)\n```\n\n```{r}\nqqnorm (m3$residuals)\nqqline (m3$residuals)\n\nshapiro.test(m3$residuals)\n```\n\n```{r}\nbartlett.test(count3 ~ spray,\n              data = inseticida)\n```\n\nCom a transforma√ß√£o de Box-Cox, os dados passaram a possuir normalidade e homocedasticidade, satisfazendo as pressuposi√ß√µes da ANOVA. Em seguida poderiam ser feitos ANOVA e compara√ß√£o de m√©dias como j√° demonstrado anteriormente.\n\n### Alternativa 2 - Usar um teste n√£o param√©trico\n\nComo a vari√°vel resposta do conjunto de dados em estudo √© do tipo num√©rica discreta e n√£o pareada, √© adotado o teste de Kruskal Wallis.\\\n\n### `kruskal.test`\n\nEssa fun√ß√£o faz um teste de Kruskal Wallis e √© √∫til apenas para informar se h√° alguma diferen√ßa estat√≠stica significativa entre os grupos.\n\n```{r}\nkruskal.test(count ~ spray,\n             data = inseticida)\n```\n\n### `kruskal` (pacote `agricolae`)\n\nAl√©m de realizar o teste de Kruskal Wallis, faz a compara√ß√£o *post hoc* utilizando o crit√©rio da diferen√ßa menos significativa de Fisher.\n\n```{r}\nlibrary(agricolae)\n\nKWT <- kruskal(inseticida$count,\n               inseticida$spray,\n               group = TRUE)\nKWT\n```\n\nO teste n√£o param√©trico resultou na mesma resposta que o modelo com os dados transformados (modelo m2).\\\n\n### Alternativa 3 - modelo linear generalizado (Generalized Linear Model - GLM)\n\nO uso de modelos lineares generalizados pode ser visto como um m√©todo de transforma√ß√£o mais bonito e elegante que os apresentados anteriormente, mesmo que ambas as metodologias estejam corretas.\\\nCom o GLM, o modelo (a fun√ß√£o) mais apropriado √© definido de acordo com a distribui√ß√£o dos dados em an√°lise.\\\nNeste exemplo, ser√° aplicada uma distribui√ß√£o de Poisson, j√° que a vari√°vel resposta √© do tipo num√©rica discreta.\n\nA fun√ß√£o `glm` √© utilizada para ajustar o modelo linear, onde √© preciso indicar a vari√°vel resposta, a vari√°vel independente, a fam√≠lia de distribui√ß√£o de probabilidade e o conjunto de dados utilizado.\n\n```{r}\nm4 <- glm(count ~ spray,\n          family = poisson,\n          data = inseticida)\n\nsummary(m4)\nanova(m4)\n```\n\n```{r}\nlibrary(car)\nAnova(m4)\n```\n\n#### Verifica√ß√£o das pressuposi√ß√µes da ANOVA\n\n```{r}\nplot(simulateResiduals(m4))\n```\n\n#### Compara√ß√£o de m√©dias --- continuar\n\n```{r}\nm4_medias <- emmeans(m4, ~ spray,\n                     type =  \"response\") #para apresentar as m√©dias no formato original, n√£o em log#\n\nm4_medias\n\ncld(m4_medias)\n```\n\n## Experimento Fatorial - 2ANOVA\n\n### Importa√ß√£o e visualiza√ß√£o dos dados\n\n```{r}\nFAT <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=2023059672\")\n```\n\nAo aplicar o comando `theme_set (theme_bw())`, todos os gr√°ficos gerados a partir da inser√ß√£o deste comando ter√£o o tema designado, no caso \"*theme_bw*\".\n\n```{r}\ntheme_set(theme_bw())\n\nFAT %>%\n  ggplot(aes(treat, severity, color = factor(dose)))+\n  geom_jitter(width = 0.1)\n\n\nFAT %>%\n  ggplot(aes(treat, severity, color = factor(dose)))+\n  geom_jitter()+\n  facet_wrap(~dose)\n```\n\nAcima, foram apresentados dois gr√°ficos para visualiza√ß√£o dos dados. A primeira op√ß√£o, faz uso de cores para apresentar as respostas associados aos n√≠veis do fator dose, enquanto os n√≠veis do fator \"treat\" s√£o apresentados no eixo x.\\\nJ√° a segunda op√ß√£o, faz uso da fun√ß√£o `facet_wrap`, em que s√£o constru√≠dos dois gr√°ficos, um para cada n√≠vel do fator dose.\n\n### Ajustar o modelo fatorial\n\nPara construir o modelo para experimento com arranjo fatorial ainda ser√° utilizada a fun√ß√£o `lm`. No entanto, como dois ou mais fatores ser√£o avaliados √© preciso incluir as outras vari√°veis independentes no modelo. Dessa forma, a f√≥rmula seria baseada em: vari√°vel `resposta`**\\~**`var√≠avel indepedente_1`**\\***`var√≠avel indepedente_2`.\n\n```{r}\nmf <- lm (severity ~ treat*dose,\n          data = FAT)\n```\n\n### ANOVA com 2 fatores\n\n```{r}\nanova(mf)\n```\n\nA an√°lise de vari√¢ncia nos mostra que h√° diferen√ßa entre as m√©dias dos tratamentos (treat, F =4.754e-05), entre as m√©dias das doses (dose, F = 0.0004077), e que tamb√©m h√° diferen√ßas significativas na intera√ß√£o tratamento\\*dose (treat:dose, F = 0.0004326).\n\nPortanto, como h√° intera√ß√µes entre fatores, ser√° preciso decompor as m√©dias e realizar compara√ß√µes para os n√≠veis das doses dentro do fator tratamento, e dos n√≠veis do tratamentos dentro do fator dose.\n\n### Verifica√ß√£o das premissas - `DHARMa`\n\n```{r}\nplot(simulateResiduals(mf))\n```\n\nOs resultados obtidos pelo pacote `DHARMa` demonstram que os dados seguem distribui√ß√£o normal e h√° homogeneidade de vari√¢ncia entre os grupos.\n\n### Compara√ß√£o de m√©dias\n\nPara compara√ß√£o de m√©dias, tamb√©m ser√° utilizada a fun√ß√£o `emmeans`, e para an√°lise de um fator dentro de outro √© preciso indicar a ordem dos fatores, separado por uma barra ( **\\|** ).\n\n#### Compara√ß√£o dos n√≠ves do tratamento dentro dos n√≠veis da dose\n\n```{r}\nmf_medias <- emmeans(mf, ~ treat | dose)\ncld(mf_medias)\n```\n\n#### Compara√ß√£o dos n√≠ves da dose dentro dos n√≠veis do tratamento\n\n```{r}\nmf_medias <- emmeans(mf, ~ dose | treat) \ncld(mf_medias)\n```\n","srcMarkdownNoYaml":"\n\n# Aula 07\n\n## Carregando os pacotes\n\n```{r}\nlibrary(gsheet)\nlibrary(tidyverse)\nlibrary(performance)\nlibrary(DHARMa)\nlibrary(emmeans)\nlibrary(multcomp)\nlibrary(multcompView)\n```\n\n## Exemplo de An√°lise de Vari√¢ncia (ANOVA)\n\nPara realizar a an√°lise de vari√¢ncia (ANOVA), ser√° carregado um conjunto de dados presente no R (conjunto `InsectSprays`), que ser√° atribu√≠do a um objeto:\n\n```{r}\ninseticida <- InsectSprays\n\ninseticida %>% \n  count(spray)\n```\n\nCom a f√≥rmula `count`, identificamos que nesse conjunto de dados h√° um fator (inseticida), com 6 n√≠veis (tipos de inseticidas), cada n√≠vel com 12 observa√ß√µes.\\\n\n## Explorando o conjunto\n\n```{r}\ninseticida %>%\n  ggplot(aes(spray, count))+\n  geom_boxplot(width = 0.5)\n```\n\nCom o boxplot gerado, √© poss√≠vel notar que h√° tratamentos que diferem dos demais.\\\n\n## Ajustar o modelo para ANOVA\n\nPara realizar a ANOVA √© preciso ajustar um modelo (`lm`). Isso √© necess√°rio para que os res√≠duos possam ser aplicados nos testes para verifica√ß√£o das premissas da anova. O modelo ser√° atribu√≠do a um objeto.\n\n```{r}\nm1 <- lm(count~spray, data = inseticida)\nsummary(m1)\n```\n\n### ANOVA\n\nUma vez definido o modelo, ele ser√° utilizado como um argumento na fun√ß√£o `anova`:\n\n```{r}\nanova(m1)\n```\n\nCom a an√°lise de vari√¢ncia e interpreta√ß√£o da estat√≠stica \"*F*\" √© poss√≠vel dizer que dentre os tratamentos, h√° algum que difere estatisticamente dos demais.\\\n\\\n\n## Avalia√ß√£o das premissas\n\n### Estrat√©gia 1\n\nPrimeiro, ser√° analisada a normalidade dos res√≠duos de maneira visual (fun√ß√£o `hist`) e estatisticamente (fun√ß√£o `shapiro.test`).\n\n```{r}\nhist(m1$residuals)\n\nshapiro.test(m1$residuals)\n```\n\nApesar do histograma possuir aspecto de normalidade, o teste de Shapiro-Wilk demonstra que os res√≠duos n√£o possuem normalidade (valor de P = 0.02).\\\n\\\nA normalidade tamb√©m pode ser avaliada visualmente em um gr√°ifco Q-Q, com as fun√ß√µes `qqnorm` e `qqline`:\n\n```{r}\nqqnorm(m1$residuals)\nqqline(m1$residuals)\n```\n\nO gr√°fico Q-Q mostra que os pontos desviam da linha de normalidade apenas nas regi√µes extremas, o que justifica o fato do teste de Shapiro-Wilk ter rejeitado a hip√≥tese de normalidade dos res√≠duos.\\\n\\\n\\\nEm sequ√™ncia, com o teste de Bartlett (`bartlett.test`), ser√° avaliada a homogeneidade das vari√¢ncias entre os grupos:\n\n```{r}\nbartlett.test(count ~ spray,\n              data = inseticida)\n```\n\nO teste de Bartlett demonstra que as vari√¢ncias s√£o heterog√™neas, pois valor de P √© menor que 0.01.\n\n### Estrat√©gia 2\n\nUsando o pacote **`performance`**:\n\n```{r}\ncheck_normality(m1)\n```\n\n```{r}\ncheck_heteroscedasticity(m1)\n```\n\nO testes `check_normality` e `check_heteroscedasticity` resultaram em n√£o normalidade dos res√≠duos e heterocedasticidade entre os grupos.\n\n### Estrat√©gia 3\n\nCom o pacote **`DHARMa`**:\n\n```{r}\nplot(simulateResiduals(m1))\n```\n\nDa mesma forma que as estrat√©gias anteriores, aqui observa-se falta de normalidade e homogeneidade entre as vari√¢ncias dos grupos.\n\n## Transforma√ß√£o dos dados\n\nDiante dos resultados obtidos, conclui-se que o conjunto de dados n√£o atende as pressuposi√ß√µes da ANOVA, logo √© necess√°rio definir uma estrat√©gia para prosseguir na an√°lise dos dados. √â poss√≠vel realizar transforma√ß√µes da vari√°vel resposta, adotar um teste n√£o-param√©trico (por exemplo, teste de Kruskal-Wallis), ou utilizar um modelo linear generalizado (Generalized Linear Model - GLM). A seguir, s√£o apresentados exemplos de como se adotar cada estrat√©gia:\n\n### Alternativa 1 - Raiz quadrada\n\nOs dados ser√£o transformados com a fun√ß√£o `sqrt` e a coluna da vari√°vel resposta ser√° substitu√≠da com os novos valores:\n\n```{r}\ninseticida <- inseticida %>% \n  mutate(count2 = sqrt(count))\n\nglimpse(inseticida)\n```\n\n#### An√°lise visual dos dados transformados\n\n```{r}\ninseticida %>%\n  ggplot(aes(spray, count2))+\n  geom_boxplot(width = 0.5)\n\n```\n\nVisualmente, √© poss√≠vel dizer que, possivelmente, os dados transformados agora possuem normalidade e homocedasticidade, pois os valores de mediana tendem a se encontrar nos centros da caixas e essas tem tamanho mais ou menos similar entre si.\n\n#### Ajuste do novo modelo\n\n```{r}\nm2 <- lm(count2 ~ spray,\n         data = inseticida)\n\nsummary(m2)\n```\n\n#### ANOVA com os novos dados\n\n```{r}\nanova (m2)\n```\n\nMesmo ap√≥s transforma√ß√£o, os dados continuem apresentando diferen√ßa significativa, ou seja, h√° pelo menos uma m√©dia que difere das demais.\n\n#### Avalia√ß√£o das premissas - Normalidade\n\n```{r}\nhist(m2$residuals)\n```\n\n```{r}\nqqnorm(m2$residuals)\nqqline(m2$residuals)\n```\n\n```{r}\nshapiro.test(m2$residuals)\n```\n\nVisual e estatisticamente, conclui-se que os res√≠duos do conjunto de dados transformados possuem distribui√ß√£o normal.\n\n#### Avalia√ß√£o das premissas - Homocedasticidade\n\n```{r}\nbartlett.test(count2 ~ spray,\n              data = inseticida)\n```\n\nAp√≥s a transforma√ß√£o, √© poss√≠vel dizer que h√° homogeneidade de vari√¢ncias entre os grupos.\n\n#### Avalia√ß√£o das premissas - Pacote `performance`:\n\n```{r}\ncheck_normality(m2)\ncheck_heteroscedasticity(m2)\n```\n\n#### Avalia√ß√£o das premissas - Pacote **`DHARMa`**\n\n```{r}\nplot(simulateResiduals(m2))\n```\n\nAp√≥s os v√°rios testes realizados, temos confian√ßa que os dados transformados possuem distribui√ß√£o normal e homogeneidade das vari√¢ncias. Logo, √© poss√≠vel realizar compara√ß√µes de m√©dias.\n\n### Compara√ß√£o de m√©dias\n\n#### Para o modelo 1 - n√£o transformado (n√£o atendendo √†s pressuposi√ß√µes):\n\nApenas √† t√≠tulo de curiosidade, ser√° feita uma compara√ß√£o de m√©dias com base nos valores originais. O que n√£o √© correto, uma vez que esses n√£o satisfazem as pressuposi√ß√µes da ANOVA.\\\nPara isso, a fun√ß√£o `emmeans`, indicando o modelo (m1) e os tratamentos (spray), ser√° atribu√≠da a um objeto.\n\n```{r}\nm1_medias <- emmeans(m1, ~ spray)\nplot(m1_medias)\n```\n\nO gr√°fico gerado mostra que para essa situa√ß√£o, os tratamentos tendem a formar dois grupos de efici√™ncia.\n\n```{r}\nmultcomp::cld(m1_medias)\n```\n\nO que √© comprovado estatisticamente pela compara√ß√£o de m√©dias, utilizando o teste de Tukey.\n\n#### Para o modelo 2 - transformado\n\nPara os dados transformados, ser√£o aplicados os mesmos passos descritos acima:\n\n```{r}\nm2_medias <- emmeans(m2, ~ spray)\nplot(m2_medias)\n```\n\nVisualmente, √© poss√≠vel dizer que os inseticidas formam tr√™s grupos distintos.\n\n```{r}\nmultcomp::cld(m2_medias)\n```\n\nCom a m√©dia transformada, o teste de Tukey agrupa os tratamentos em 3 grupos distintos, logo houve melhor discrimina√ß√£o. Com isso, conclu√≠mos que, em compara√ß√£o aos demais, o inseticida C foi o mais eficiente, pois apresentou menor n√∫mero de insetos contados. Em seguida, os inseticidas E e D apresentaram desempenho intermedi√°rio. Por fim, h√° um grupo com os inseticidas menos eficientes, nesse caso, contendo os tratamentos A, B e F.\n\n#### Alternativas para visualiza√ß√£o das compara√ß√µes de m√©dias\n\n#### Fun√ß√£o `pwpm`:\n\nA fun√ß√£o `pwpm` (`emmeans`) constr√≥i uma matriz de valores de probabilidade, onde s√£o apresentadas as compara√ß√µes entre tratamentos, par a par. Nas diagonais, entre colchetes, s√£o apresentados os valores de m√©dia de cada tratamento.\n\n```{r}\npwpm(m2_medias)\n```\n\n#### Fun√ß√£o `pwpp`:\n\nA fun√ß√£o `pwpp` (`emmeans`) constr√≥i uma plotagem de valores de probabilidade associados as compara√ß√µes pareadas das m√©dias marginais estimadas.\n\n```{r}\npwpp (m2_medias)\n```\n\n#### Fun√ß√£o `pairs`:\n\nA fun√ß√£o `pairs` apresenta os contrastes ortogonais dos valores de m√©dias dos tratamentos, associados aos valores de probabilidade.\n\n```{r}\npairs(m2_medias)\n```\n\n### Alternativa 1.2 - Transforma√ß√£o de Box--Cox\n\nPara tentar sanar o problema da falta de normalidade e/ou heterocedasticidade, √© poss√≠vel utilizar um segundo tipo de transforma√ß√£o, neste caso a transforma√ß√£o de Box-Cox.\n\nA transforma√ß√£o de Box-Cox se baseia na seguinte equa√ß√£o:\n\n$y_{(\\lambda)} = (y^{\\lambda} - 1)/ \\lambda$\n\nOnde, y representa a vari√°vel resposta original; $y_{(\\lambda)}$ √© a vari√°vel resposta transformada; e lambda (ùõå) √© o par√¢metro de transforma√ß√£o, variando entre - ‚àû e + ‚àû.\n\n\\\nPara conduzir essa transforma√ß√£o, √© utilizada a fun√ß√£o `boxcox` (pacote `MASS`). A fun√ß√£o calcula e identifica o valor ùõå √≥timo para um determinado conjunto de dados (onde o valor de Y √© m√°ximo).\n\n```{r}\nlibrary(MASS)\n\nb <- boxcox(lm(inseticida$count + 0.1 ~ 1))\n```\n\n```{r}\nlambda <- b$x [which.max(b$y)]\nlambda\n```\n\nCom os comandos acima √© poss√≠vel determinar na equa√ß√£o (b) o valor de ùõå (no eixo x), cujo valor de y √© m√°ximo. Logo, para o conjunto em an√°lise, ùõå ‚âÖ 0.42.\n\n#### Transformando os dados com Box-Cox\n\nCom o valor calculado acima, realiza-se a transforma√ß√£o de Box-Cox:\n\n```{r}\ninseticida$count3 <-(inseticida$count ^ lambda - 1) / lambda\n```\n\n\\\nNovo modelo\n\n```{r}\nm3 <- lm(count3 ~ spray,\n         data = inseticida)\n```\n\n\\\nAvalia√ß√£o de normalidade e homogeneidade de vari√¢ncias entre os grupos:\n\n```{r}\nhist(inseticida$count3)\n```\n\n```{r}\nqqnorm (m3$residuals)\nqqline (m3$residuals)\n\nshapiro.test(m3$residuals)\n```\n\n```{r}\nbartlett.test(count3 ~ spray,\n              data = inseticida)\n```\n\nCom a transforma√ß√£o de Box-Cox, os dados passaram a possuir normalidade e homocedasticidade, satisfazendo as pressuposi√ß√µes da ANOVA. Em seguida poderiam ser feitos ANOVA e compara√ß√£o de m√©dias como j√° demonstrado anteriormente.\n\n### Alternativa 2 - Usar um teste n√£o param√©trico\n\nComo a vari√°vel resposta do conjunto de dados em estudo √© do tipo num√©rica discreta e n√£o pareada, √© adotado o teste de Kruskal Wallis.\\\n\n### `kruskal.test`\n\nEssa fun√ß√£o faz um teste de Kruskal Wallis e √© √∫til apenas para informar se h√° alguma diferen√ßa estat√≠stica significativa entre os grupos.\n\n```{r}\nkruskal.test(count ~ spray,\n             data = inseticida)\n```\n\n### `kruskal` (pacote `agricolae`)\n\nAl√©m de realizar o teste de Kruskal Wallis, faz a compara√ß√£o *post hoc* utilizando o crit√©rio da diferen√ßa menos significativa de Fisher.\n\n```{r}\nlibrary(agricolae)\n\nKWT <- kruskal(inseticida$count,\n               inseticida$spray,\n               group = TRUE)\nKWT\n```\n\nO teste n√£o param√©trico resultou na mesma resposta que o modelo com os dados transformados (modelo m2).\\\n\n### Alternativa 3 - modelo linear generalizado (Generalized Linear Model - GLM)\n\nO uso de modelos lineares generalizados pode ser visto como um m√©todo de transforma√ß√£o mais bonito e elegante que os apresentados anteriormente, mesmo que ambas as metodologias estejam corretas.\\\nCom o GLM, o modelo (a fun√ß√£o) mais apropriado √© definido de acordo com a distribui√ß√£o dos dados em an√°lise.\\\nNeste exemplo, ser√° aplicada uma distribui√ß√£o de Poisson, j√° que a vari√°vel resposta √© do tipo num√©rica discreta.\n\nA fun√ß√£o `glm` √© utilizada para ajustar o modelo linear, onde √© preciso indicar a vari√°vel resposta, a vari√°vel independente, a fam√≠lia de distribui√ß√£o de probabilidade e o conjunto de dados utilizado.\n\n```{r}\nm4 <- glm(count ~ spray,\n          family = poisson,\n          data = inseticida)\n\nsummary(m4)\nanova(m4)\n```\n\n```{r}\nlibrary(car)\nAnova(m4)\n```\n\n#### Verifica√ß√£o das pressuposi√ß√µes da ANOVA\n\n```{r}\nplot(simulateResiduals(m4))\n```\n\n#### Compara√ß√£o de m√©dias --- continuar\n\n```{r}\nm4_medias <- emmeans(m4, ~ spray,\n                     type =  \"response\") #para apresentar as m√©dias no formato original, n√£o em log#\n\nm4_medias\n\ncld(m4_medias)\n```\n\n## Experimento Fatorial - 2ANOVA\n\n### Importa√ß√£o e visualiza√ß√£o dos dados\n\n```{r}\nFAT <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=2023059672\")\n```\n\nAo aplicar o comando `theme_set (theme_bw())`, todos os gr√°ficos gerados a partir da inser√ß√£o deste comando ter√£o o tema designado, no caso \"*theme_bw*\".\n\n```{r}\ntheme_set(theme_bw())\n\nFAT %>%\n  ggplot(aes(treat, severity, color = factor(dose)))+\n  geom_jitter(width = 0.1)\n\n\nFAT %>%\n  ggplot(aes(treat, severity, color = factor(dose)))+\n  geom_jitter()+\n  facet_wrap(~dose)\n```\n\nAcima, foram apresentados dois gr√°ficos para visualiza√ß√£o dos dados. A primeira op√ß√£o, faz uso de cores para apresentar as respostas associados aos n√≠veis do fator dose, enquanto os n√≠veis do fator \"treat\" s√£o apresentados no eixo x.\\\nJ√° a segunda op√ß√£o, faz uso da fun√ß√£o `facet_wrap`, em que s√£o constru√≠dos dois gr√°ficos, um para cada n√≠vel do fator dose.\n\n### Ajustar o modelo fatorial\n\nPara construir o modelo para experimento com arranjo fatorial ainda ser√° utilizada a fun√ß√£o `lm`. No entanto, como dois ou mais fatores ser√£o avaliados √© preciso incluir as outras vari√°veis independentes no modelo. Dessa forma, a f√≥rmula seria baseada em: vari√°vel `resposta`**\\~**`var√≠avel indepedente_1`**\\***`var√≠avel indepedente_2`.\n\n```{r}\nmf <- lm (severity ~ treat*dose,\n          data = FAT)\n```\n\n### ANOVA com 2 fatores\n\n```{r}\nanova(mf)\n```\n\nA an√°lise de vari√¢ncia nos mostra que h√° diferen√ßa entre as m√©dias dos tratamentos (treat, F =4.754e-05), entre as m√©dias das doses (dose, F = 0.0004077), e que tamb√©m h√° diferen√ßas significativas na intera√ß√£o tratamento\\*dose (treat:dose, F = 0.0004326).\n\nPortanto, como h√° intera√ß√µes entre fatores, ser√° preciso decompor as m√©dias e realizar compara√ß√µes para os n√≠veis das doses dentro do fator tratamento, e dos n√≠veis do tratamentos dentro do fator dose.\n\n### Verifica√ß√£o das premissas - `DHARMa`\n\n```{r}\nplot(simulateResiduals(mf))\n```\n\nOs resultados obtidos pelo pacote `DHARMa` demonstram que os dados seguem distribui√ß√£o normal e h√° homogeneidade de vari√¢ncia entre os grupos.\n\n### Compara√ß√£o de m√©dias\n\nPara compara√ß√£o de m√©dias, tamb√©m ser√° utilizada a fun√ß√£o `emmeans`, e para an√°lise de um fator dentro de outro √© preciso indicar a ordem dos fatores, separado por uma barra ( **\\|** ).\n\n#### Compara√ß√£o dos n√≠ves do tratamento dentro dos n√≠veis da dose\n\n```{r}\nmf_medias <- emmeans(mf, ~ treat | dose)\ncld(mf_medias)\n```\n\n#### Compara√ß√£o dos n√≠ves da dose dentro dos n√≠veis do tratamento\n\n```{r}\nmf_medias <- emmeans(mf, ~ dose | treat) \ncld(mf_medias)\n```\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css"],"toc":true,"output-file":"Aula 7.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.4.553","editor":"visual","theme":"navbars","title":"Aula 7 - Estat√≠stica inferencial: ANOVA","author":"Caio"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}